<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <title>Crossroad</title>
        <script type='text/javascript' src='https://www.x3dom.org/download/x3dom.js'> </script>
        <script>
            var lightState = 1;
            function swapLights(passedTime){
                if(passedTime == 10){
                    if(lightState == 0){
                        lightState = 1;
                        document.getElementById('output').setAttribute('string', "green");
                    }else{
                        lightState = 0;
                        document.getElementById('output').setAttribute('string', "red");
                    }
                }
            }
            
            function clockingEvent(eventObject){
                if(eventObject.type != "outputchange" || eventObject.fieldName != "value_changed")
                    return;
                    
                var output = parseInt(eventObject.value);
                swapLights(output);
            }
        </script>
        <style>
            x3d
            {
                border:2px solid darkorange;
                background: rgba(128, 128, 128, 0.4);
            }

            body
            {
                font-size:110%;
                font-family:verdana, sans-serif;
                margin: 3em;
                color: lightgray;
            }

            h1
            {
                color: darkorange;
            }
        </style>
    </head>
    <body>
        <h1>Crossroad</h1>
        <p>This is a showroom</p>
        <x3d width='900px' height='600px' showStat="true">
            <scene id="mainScene">
                <transform id="car1" DEF="car1" translation="0 3 0">
                    <transform rotation="0 1 0 -1.5708">
                        <Inline url="models/cars/car.x3d"></Inline>
                    </transform>
                </transform>
                <transform DEF="car2" translation="0 3 0">
                    <transform rotation="0 1 0 3.1416">
                        <Inline url="models/cars/car.x3d"></Inline>
                    </transform>
                </transform>
                <transform DEF="car3" translation="0 3 0">
                    <transform rotation="0 1 0 1.5708">
                        <Inline url="models/cars/car.x3d"></Inline>
                    </transform>
                </transform>
                <transform DEF="car4" translation="0 3 0">
                    <Inline url="models/cars/car.x3d"></Inline>
                </transform>
                <transform translation="1 6 0">
                    <shape>
                        <Text id="output" DEF="txt" string='"green"'>
                            <FontStyle DEF='MiddleJustify' justify='"MIDDLE" "MIDDLE"'/>
                        </Text> 
                    </shape>
                </transform>
                
                <timeSensor id="generalClock" DEF="generalClock" startTime="0.1" cycleInterval=10 loop=true></timeSensor>
                <ScalarInterpolator DEF="timePast" key="0 0.5 1" keyValue="0, 5, 10" onoutputchange="clockingEvent(event)"></ScalarInterpolator>
                <Route fromNode="generalClock" fromField="fraction_changed" toNode="timePast" toField="set_fraction"></Route>
                
                <timeSensor DEF="clock1" startTime="5.1" cycleInterval="10" loop="true"></timeSensor>
                <timeSensor DEF="clock2" startTime="15.1" cycleInterval="10" loop="true"></timeSensor>
                <timeSensor DEF="clock3" startTime="5.1" cycleInterval="10" loop="true"></timeSensor>
                <timeSensor DEF="clock4" startTime="15.1" cycleInterval="10" loop="true"></timeSensor>
                
                <PositionInterpolator DEF="move1" key="0 0.2 0.8 1" keyValue="-100 2 3, -20 2 3, -20 2 3, 100 2 3"></PositionInterpolator>
                <PositionInterpolator DEF="move2" key="0 0.2 0.8 1" keyValue="-3 2 -100, -3 2 -20, -3 2 -20, -3 2 100"></PositionInterpolator>
                <PositionInterpolator DEF="move3" key="0 0.2 0.8 1" keyValue="100 2 -3, 20 2 -3, 20 2 -3, -100 2 3"></PositionInterpolator>
                <PositionInterpolator DEF="move4" key="0 0.2 0.8 1" keyValue="3 2 100, 3 2 20, 3 2 20, 3 2 -100"></PositionInterpolator>
                
                <Route fromNode="clock1" fromField="fraction_changed" toNode="move1" toField="set_fraction"></Route>
                <Route fromNode="clock2" fromField="fraction_changed" toNode="move2" toField="set_fraction"></Route>
                <Route fromNode="clock3" fromField="fraction_changed" toNode="move3" toField="set_fraction"></Route>
                <Route fromNode="clock4" fromField="fraction_changed" toNode="move4" toField="set_fraction"></Route>
                
                <Route fromNode="move1" fromField="value_changed" toNode="car1" toField="translation"></Route>
                <Route fromNode="move2" fromField="value_changed" toNode="car2" toField="translation"></Route>
                <Route fromNode="move3" fromField="value_changed" toNode="car3" toField="translation"></Route>
                <Route fromNode="move4" fromField="value_changed" toNode="car4" toField="translation"></Route>
        
                <Inline url="models/basic_environment/intersection.x3d"></Inline>
			
				<Inline url="models/buildings/Buildings.x3d"></Inline>

				<Transform scale="1 1 1" translation="56 0 56">
                    <Inline url="models/park/park.x3d"></Inline>
				</Transform>
            </scene>
        </x3d>
    </body>
</html>
